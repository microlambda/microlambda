"use strict";(self.webpackChunkmila_docs=self.webpackChunkmila_docs||[]).push([[218],{3905:(e,r,t)=>{t.d(r,{Zo:()=>u,kt:()=>m});var n=t(7294);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=n.createContext({}),l=function(e){var r=n.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):i(i({},r),e)),t},u=function(e){var r=l(e.components);return n.createElement(c.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(t),m=a,f=d["".concat(c,".").concat(m)]||d[m]||p[m]||o;return t?n.createElement(f,i(i({ref:r},u),{},{components:t})):n.createElement(f,i({ref:r},u))}));function m(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var c in r)hasOwnProperty.call(r,c)&&(s[c]=r[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6046:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=t(7462),a=(t(7294),t(3905));const o={sidebar_position:5},i="Manage shared infrastructure",s={unversionedId:"tutorial-basics/manage-shared-infrastructure",id:"tutorial-basics/manage-shared-infrastructure",title:"Manage shared infrastructure",description:"Some resources need to be shared among multiple microservices and/or environments.",source:"@site/docs/1-tutorial-basics/5-manage-shared-infrastructure.md",sourceDirName:"1-tutorial-basics",slug:"/tutorial-basics/manage-shared-infrastructure",permalink:"/docs/tutorial-basics/manage-shared-infrastructure",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Create a new package",permalink:"/docs/tutorial-basics/create-package-and-services"},next:{title:"Using middleware",permalink:"/docs/tutorial-basics/using-middleware"}},c={},l=[],u={toc:l};function p(e){let{components:r,...t}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,t,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"manage-shared-infrastructure"},"Manage shared infrastructure"),(0,a.kt)("p",null,"Some resources need to be shared among multiple microservices and/or environments.\nProvisioning them through one of the serverless templates of a microservice wouldn't be wise.\nIf we were to delete that service, all the resources would be destroyed, including the shared resources\n(potentially used by other services as well)."),(0,a.kt)("p",null,"Microlambda offers a simple yet effective way to manage infrastructure shared among multiple instances of microservices\n(log buckets, secrets, lambdas for asynchronous middleware processing, etc.).\nYou just need to create special yarn workspaces whose ",(0,a.kt)("inlineCode",{parentName:"p"},"mila.json")," files contain the ",(0,a.kt)("inlineCode",{parentName:"p"},"infra:deploy")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"infra:remove")," targets.\nSuch packages are considered by Microlambda as packages used for provisioning shared infrastructure."),(0,a.kt)("p",null,"Before deploying the services, Microlambda will execute the ",(0,a.kt)("inlineCode",{parentName:"p"},"infra:deploy")," script for each package in each target region where\nthe environment is replicated, in topological order."),(0,a.kt)("p",null,"Since Microlambda targets are used, the remote cache is utilized by default unless the ",(0,a.kt)("inlineCode",{parentName:"p"},"--force")," option is provided.\nAs a result, between two deployment executions, shared infrastructure that has not been modified is not redeployed for\nperformance reasons."),(0,a.kt)("p",null,"You can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"mila.json")," configuration file of the workspace to explicitly specify whether an environment-specific deployment\nshould be performed or not."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n "sharedInfra": { "envSpecific": true }\n}\n')),(0,a.kt)("p",null,"If the option is set to true, Microlambda will create a cache instance for each environment and pass ",(0,a.kt)("inlineCode",{parentName:"p"},"ENV=<env>")," as an\nenvironment variable to the runner during the execution of the ",(0,a.kt)("inlineCode",{parentName:"p"},"infra:deploy")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"infra:remove")," scripts."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'We recommend using CloudFormation to provision these resources to maintain consistency with the rest of the project in\nterms of technologies. This is the example we provide in the base project. However, it is entirely possible to use\nTerraform or custom scripts, as Microlambda simply executes the "infra:deploy" and "infra:remove" scripts."')))}p.isMDXComponent=!0}}]);