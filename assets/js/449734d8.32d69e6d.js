"use strict";(self.webpackChunkmila_docs=self.webpackChunkmila_docs||[]).push([[431],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=l(n),m=a,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||s;return n?r.createElement(h,o(o({ref:t},d),{},{components:n})):r.createElement(h,o({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,o=new Array(s);o[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var l=2;l<s;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9377:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const s={sidebar_position:3},o="Unit testing",i={unversionedId:"tutorial-basics/unit-testing",id:"tutorial-basics/unit-testing",title:"Unit testing",description:"Microlambda provides utilities to unit test handlers.",source:"@site/docs/1-tutorial-basics/3-unit-testing.md",sourceDirName:"1-tutorial-basics",slug:"/tutorial-basics/unit-testing",permalink:"/docs/tutorial-basics/unit-testing",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Write your first handler",permalink:"/docs/tutorial-basics/first-handler"},next:{title:"Create a new package",permalink:"/docs/tutorial-basics/create-package-and-services"}},c={},l=[{value:"Manage authentication",id:"manage-authentication",level:2}],d={toc:l};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"unit-testing"},"Unit testing"),(0,a.kt)("p",null,"Microlambda provides utilities to unit test handlers."),(0,a.kt)("p",null,"The TestBed class from the ",(0,a.kt)("inlineCode",{parentName:"p"},"@microlambda/testing")," package allows you to run an Api Gateway handler in isolation.\nIt provides a wide range of helpers for simulating events with path parameters, headers, or query string parameters."),(0,a.kt)("p",null,"Here is an example of code for testing a handler:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { TestBed } from '@microlambda/testing';\nimport { handler } from '../src/handlers/http/create-user';\n\ndescribe('The create user handler', () => {\n  it('should return 422 if payload is invalid', async () => {\n    const testBed = new TestBed(handler);\n    testBed.body({\n      email: 'john.doe@company.com',\n      password: 'abc',\n    });\n    const response = await testBed.post();\n    expect(response.statusCode).toBe(422);\n    expect(response.body).toEqual({\n      errors: [\n        { field: 'password', msg: 'Password length should be at least 8' },\n      ],\n    });\n  });\n});\n")),(0,a.kt)("h2",{id:"manage-authentication"},"Manage authentication"),(0,a.kt)("p",null,"Feel free to extend the TestBed class to add your own utilities. "),(0,a.kt)("p",null,"Here's an example of how to mock user authentication through an external custom authorizer Lambda by overriding the requestContext:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { TestBed as MilaTestBed } from '@microlambda/testing';\nimport { handler } from '../src/handlers/http/create-user';\n\nclass TestBed extends MilaTestBed {\n  user() {\n    this.authorize({ principalId: 'test.user@myapp.io', role: 'user' });    \n  }\n  \n  admin() {\n    this.authorize({ principalId: 'test.admin@myapp.io', role: 'admin' });\n  }\n}\n\ndescribe('The create user handler', () => {\n  it('should return 401 if user is not authenticated', async () => {\n    const testBed = new TestBed(handler);\n    testBed.body({\n      email: 'john.doe@company.com',\n      password: 'mySuperSecretPassw0rd!',\n    });\n    const response = await testBed.post();\n    expect(response.statusCode).toBe(401);\n  });\n  it('should return 403 if user is not an admin', async () => {\n    const testBed = new TestBed(handler);\n    testBed.body({\n      email: 'john.doe@company.com',\n      password: 'mySuperSecretPassw0rd!',\n    });\n    const response = await testBed.user().post();\n    expect(response.statusCode).toBe(403);\n  });\n  it('should return 200 if user is an admin', async () => {\n    const testBed = new TestBed(handler);\n    testBed.body({\n      email: 'john.doe@company.com',\n      password: 'mySuperSecretPassw0rd!',\n    });\n    const response = await testBed.admin().post();\n    expect(response.statusCode).toBe(200);\n  });\n});\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Note: if used in many services, you should create a shared package to export your extended ",(0,a.kt)("inlineCode",{parentName:"p"},"TestBed"))))}p.isMDXComponent=!0}}]);