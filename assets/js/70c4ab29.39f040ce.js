"use strict";(self.webpackChunkmila_docs=self.webpackChunkmila_docs||[]).push([[653],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>p});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=l(n),p=r,f=h["".concat(c,".").concat(p)]||h[p]||u[p]||o;return n?a.createElement(f,i(i({ref:t},d),{},{components:n})):a.createElement(f,i({ref:t},d))}));function p(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},4549:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const o={sidebar_position:2},i="Understand caching",s={unversionedId:"advanced/understand-caching",id:"advanced/understand-caching",title:"Understand caching",description:"One of the main strengths of the Microlambda runner is its caching system, which saves time and resources by re-executing",source:"@site/docs/3-advanced/2-understand-caching.md",sourceDirName:"3-advanced",slug:"/advanced/understand-caching",permalink:"/docs/advanced/understand-caching",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"The runner",permalink:"/docs/advanced/mila-runner"},next:{title:"Customize blueprints",permalink:"/docs/advanced/customize-blueprints"}},c={},l=[{value:"Local and remote caching",id:"local-and-remote-caching",level:2},{value:"Configure caching",id:"configure-caching",level:2}],d={toc:l};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"understand-caching"},"Understand caching"),(0,r.kt)("p",null,"One of the main strengths of the Microlambda runner is its caching system, which saves time and resources by re-executing\ntargets only when necessary"),(0,r.kt)("h2",{id:"local-and-remote-caching"},"Local and remote caching"),(0,r.kt)("p",null,"By default, the local cache is used. The local cache stores checksums of sources and artifacts in hidden folders on the\nfilesystem of the machine that launches the process. During the next execution of a target, if the current checksums match\nthe stored checksums, the command is not rerun."),(0,r.kt)("p",null,"It is possible to bypass this cache by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--force")," option."),(0,r.kt)("p",null,"You can also use a remote cache on AWS S3 to share it among multiple workers and distribute the workload. To do this,\nsimply use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--remote-cache")," option. The bucket and region to be used will be those specified in the root configuration\nfile mila.json. The checksums of the target will be stored at the path ",(0,r.kt)("inlineCode",{parentName:"p"},"caches/<workspace-name>/<cmd-name>"),". The artifacts\nwill also be uploaded to this path. During the next execution, if there is a cache hit, they will be downloaded, and\neverything will proceed as if the command had actually been executed on the worker."),(0,r.kt)("h2",{id:"configure-caching"},"Configure caching"),(0,r.kt)("p",null,"In the configuration of the targets in the mila.json file, it is necessary to inform the runner about the inputs and\noutputs of the command to be executed. This way, it can check whether the inputs, i.e., the sources, of a target have\nnot been modified, and whether the artifacts produced by a target, i.e., its outputs, are still present and valid."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This is a declarative process, and it is important to keep these lists of inputs and outputs up to date to ensure that\nthe behavior is as expected and that the cache is invalidated when necessary.")),(0,r.kt)("p",null,"You can configure all the files to be considered as sources or inputs using a combination of one or more of the following three glob arrays:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"An array of globs relative to the root of the workspace."),(0,r.kt)("li",{parentName:"ul"},"An array of globs relative to the root of all dependencies."),(0,r.kt)("li",{parentName:"ul"},"An array of globs relative to the root of the project.")),(0,r.kt)("p",null,"Artifacts, on the other hand, are configured with a single array of globs relative to the root of the workspace."),(0,r.kt)("p",null,"Here is an example configuration to illustrate this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "targets": {\n    "build": {\n      "script": "tsc",\n      "src": {\n        "internals": [\n          "src/**/*.ts",\n          "tsconfig.json"\n        ],\n        "deps": [\n          "src/**/*.ts",\n          "tsconfig.json"\n        ],\n        "root": [\n          "tsconfig.json"\n        ]\n      },\n      "artifacts": [\n        "lib/**/*.js",\n        "lib/**/*.d.ts",\n        "dist/**/*.js",\n        "dist/**/*.d.ts"\n      ]\n    }\n  }\n}\n')),(0,r.kt)("p",null,"The build target will be rerun if:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Its own typescript sources change ",(0,r.kt)("inlineCode",{parentName:"li"},"src/**/*.ts"),"."),(0,r.kt)("li",{parentName:"ul"},"Its own ",(0,r.kt)("inlineCode",{parentName:"li"},"tsconfig.json")," change."),(0,r.kt)("li",{parentName:"ul"},"One of the typescript source or a ",(0,r.kt)("inlineCode",{parentName:"li"},"tsconfig.json")," of any of its dependencies change."),(0,r.kt)("li",{parentName:"ul"},"The project main ",(0,r.kt)("inlineCode",{parentName:"li"},"tsconfig.json")," changed, as other configs extends it."),(0,r.kt)("li",{parentName:"ul"},"The produced artifacts ",(0,r.kt)("inlineCode",{parentName:"li"},"*.js")," and ",(0,r.kt)("inlineCode",{parentName:"li"},".d.ts")," files have changed or do not exists anymore")))}u.isMDXComponent=!0}}]);