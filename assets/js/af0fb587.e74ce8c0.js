"use strict";(self.webpackChunkmila_docs=self.webpackChunkmila_docs||[]).push([[513],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,y=d["".concat(s,".").concat(m)]||d[m]||u[m]||a;return n?o.createElement(y,i(i({ref:t},c),{},{components:n})):o.createElement(y,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6752:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var o=n(7462),r=(n(7294),n(3905));const a={sidebar_position:1},i="Your first deploy",l={unversionedId:"deployments/your-first-deploy",id:"deployments/your-first-deploy",title:"Your first deploy",description:"The first part of the documentation provides you with the keys to rapidly and productively develop a sizable serverless",source:"@site/docs/2-deployments/1-your-first-deploy.md",sourceDirName:"2-deployments",slug:"/deployments/your-first-deploy",permalink:"/docs/deployments/your-first-deploy",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Deploy your app",permalink:"/docs/category/deploy-your-app"},next:{title:"Manage environments",permalink:"/docs/deployments/manage-environments"}},s={},p=[{value:"Pre-requesites",id:"pre-requesites",level:2},{value:"Initialize remote state",id:"initialize-remote-state",level:2},{value:"Create environment",id:"create-environment",level:2},{value:"Deploy",id:"deploy",level:2}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"your-first-deploy"},"Your first deploy"),(0,r.kt)("p",null,"The first part of the documentation provides you with the keys to rapidly and productively develop a sizable serverless\napplication. Now it's time to deploy this application on AWS to allow your users to access it."),(0,r.kt)("p",null,"Microlambda offers a comprehensive suite of tools to orchestrate deployments across multiple environments (development,\nstaging, production) in a multi-regional manner. Its remote cache system enables the redeployment of only the affected\nservices, saving you valuable time on your operations."),(0,r.kt)("h2",{id:"pre-requesites"},"Pre-requesites"),(0,r.kt)("p",null,"First, you need to log in to an AWS account, either via Single Sign-On (SSO) or by exporting an AWS key pair or profile.\nYou can verify that you are logged in to the correct account by using the AWS CLI command ",(0,r.kt)("inlineCode",{parentName:"p"},"aws sts get-caller-identity"),"."),(0,r.kt)("p",null,"The AWS account you are using must have sufficient privileges to create the necessary resources (buckets, IAM roles,\nCloudFormation stacks, DynamoDB tables, etc.)."),(0,r.kt)("h2",{id:"initialize-remote-state"},"Initialize remote state"),(0,r.kt)("p",null,"Microlambda uses a remote state to keep track of every deployment."),(0,r.kt)("p",null,"The state consist of:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A DynamoDB table to store currently deployed services state and handle concurrent deployment."),(0,r.kt)("li",{parentName:"ul"},"A S3 bucket for remote caching, where checksums are stored to avoid re-deploying unaffected services.")),(0,r.kt)("p",null,"You must initialize this remote state once before your first deployment using ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn mila init")),(0,r.kt)("h2",{id:"create-environment"},"Create environment"),(0,r.kt)("p",null,"You must register on remote state the different environments of your application (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"dev"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"preprod"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"prod"),") ."),(0,r.kt)("p",null,"This is mandatory to keep track of deployments history and to manage ",(0,r.kt)("a",{parentName:"p",href:"../advanced/infrastructure-replication"},"infrastructure replication"),"."),(0,r.kt)("p",null,"We recommend following a classic Gitflow with the following environments:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A development environment for your team's developers to integrate and test their work."),(0,r.kt)("li",{parentName:"ul"},"A staging environment for your QA team to validate the batch to be deployed in production."),(0,r.kt)("li",{parentName:"ul"},"A stable production environment for your end users.")),(0,r.kt)("p",null,"Let's create a development environment using ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn mila envs create dev"),"."),(0,r.kt)("h2",{id:"deploy"},"Deploy"),(0,r.kt)("p",null,"Now that these preliminary steps are complete, it's time to plan our first deployment \ud83d\ude80."),(0,r.kt)("p",null,"To do this, run the command ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn mila deploy -e dev.")),(0,r.kt)("p",null,"The Microlambda CLI will then compare the state of your services as recorded in the remote state with the current state\nof your codebase and resolve the deployment operations to be performed.\nIt will display a table specifying the action to be taken for each service and each regional replica in order to match\nthe remote service state with that of your codebase. "),(0,r.kt)("p",null,"These actions can be:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"first_deploy"),": if the service has never been deployed in this region before."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deploy"),": if the service has already been deployed but its source code or that of one of its dependencies has changed."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"no_changes"),": if the code hasn't changed, and deployment can be skipped."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"destroy"),": if the service no longer exists in your codebase or if the region has been removed in state.")),(0,r.kt)("p",null,"Once this plan is calculated, you can confirm its application and initiate the deployment of all services in parallel."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Microlambda performs its operations in parallel, with a default concurrency level equal to half the threads of your machine. You can override this behavior with the '-c' option.")),(0,r.kt)("p",null,"This first deployment was done from your machine to demonstrate how Microlambda orchestrates deployments.\nHowever, we recommend quickly setting up CI/CD pipelines to automate deployments.\nYou can automatically deploy your environments upon merging into the main ",(0,r.kt)("inlineCode",{parentName:"p"},"dev"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"staging"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"main")," branches.\nYou can use Microlambda in your pipeline, and we invite you to run ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn mila deploy --help")," to see the available options, including:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-s")," to evaluate the plan and deploy only one or several services (comma-separated). Useful if you want to parallelize in multiple jobs."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--no-prompt"),": skip confirmation, useful as we don't have stdin in CI."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--on-prompt"),': calculate and display only the deployment plan. Useful if you want to resolve the entire plan and then apply it after review in a manual step."')))}u.isMDXComponent=!0}}]);