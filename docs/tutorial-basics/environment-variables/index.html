<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorial-basics/environment-variables">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Lambdas Environment Variables | Microlambda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://microlambda.dev/docs/tutorial-basics/environment-variables"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="lambda, aws"><meta data-rh="true" name="og:image" content="https://avatars.githubusercontent.com/u/81293962"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lambdas Environment Variables | Microlambda"><meta data-rh="true" name="description" content="Using dotenv"><meta data-rh="true" property="og:description" content="Using dotenv"><link data-rh="true" rel="icon" href="/img/logo-white.svg"><link data-rh="true" rel="canonical" href="https://microlambda.dev/docs/tutorial-basics/environment-variables"><link data-rh="true" rel="alternate" href="https://microlambda.dev/docs/tutorial-basics/environment-variables" hreflang="en"><link data-rh="true" rel="alternate" href="https://microlambda.dev/docs/tutorial-basics/environment-variables" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Microlambda RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Microlambda Atom Feed"><link rel="stylesheet" href="/assets/css/styles.9a8d7903.css">
<link rel="preload" href="/assets/js/runtime~main.8c86b5e8.js" as="script">
<link rel="preload" href="/assets/js/main.0bf2ee4f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-white.svg" alt="Microlambda Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-white.svg" alt="Microlambda Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Microlambda</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microlambda/microlambda" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/category/learn-microlambda">Learn microlambda</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-basics/project-structure">Project structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-basics/first-handler">Write your first handler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-basics/unit-testing">Unit testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-basics/create-package-and-services">Create a new package</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-basics/manage-shared-infrastructure">Manage shared infrastructure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-basics/using-middleware">Using middleware</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorial-basics/environment-variables">Lambdas Environment Variables</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/category/deploy-your-app">Deploy your app</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployments/your-first-deploy">Your first deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployments/manage-environments">Manage environments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployments/using-custom-domains">Using custom domains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployments/using-layers">Using layers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/category/advanced-concepts">Advanced concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/mila-runner">The runner</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/understand-caching">Understand caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/customize-blueprints">Customize blueprints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/infrastructure-replication">Infrastructure replication</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/learn-microlambda"><span itemprop="name">Learn microlambda</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lambdas Environment Variables</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lambdas Environment Variables</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-dotenv">Using dotenv<a href="#using-dotenv" class="hash-link" aria-label="Direct link to Using dotenv" title="Direct link to Using dotenv">​</a></h2><p>Microlambda provides a convenient way to deal with environment variables and secrets in a large scale project, with multiple environments and multiple services.</p><p>It removes duplication by allowing you to inject some variables for all services at all stages (dev, int, prod).</p><p><strong>And</strong> allows you to add/overwrite values per stage only at environment or service level.</p><p>You just need to define the variables in the correct dotenv file, according to the variables scope (global, only for a micro-service, an environment).</p><p>Here is the dotenv files organization:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">| envs/ # Contains the root environment, shared between services</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|--.env         # Env shared between services and stages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|--.env.local   # Env shared between services for a given stage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|--.env.dev</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|--.env.prod</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| services/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|-- hello-world/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|-- src/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|-- envs/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|---- .env           # Env only used for a service and all stages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|---- .env.local     # Env only used for a service and a given env</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|---- .env.dev</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|---- .env.prod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Just like dotenv, if the value already exists in your environment process when deploying or running in local, it will be used instead the one specified in dotenv file.</p></blockquote><p>When deploying or starting the project, the microlambda serverless plugin will automatically populate Lambda environment.
You do not need to maintain the environment section of serverless.yml anymore.</p><blockquote><p>If a variable with the same key is defined in more than one dotenv file, the <strong>most specific take precedence</strong>.
The precedence order is the following (from least precise to most, the next value take precedence on previous): </p><ul><li>main dotenv in <code>env/.env</code></li><li>main environment-specific dotenvs <code>env/.env.&lt;env-name&gt;</code></li><li>service-specific dotenvs <code>services/&lt;service-name&gt;/envs/.env</code></li><li>Environment-specific and service-specific dotenvs <code>services/&lt;service-name&gt;/envs/.env.&lt;env-name&gt;</code></li></ul></blockquote><blockquote><p>This is a helper to define more conveniently environment variables scopes, but you still can use serverless.yml
environment section if you want to.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="injecting-parameters-from-aws-ssm">Injecting parameters from AWS SSM<a href="#injecting-parameters-from-aws-ssm" class="hash-link" aria-label="Direct link to Injecting parameters from AWS SSM" title="Direct link to Injecting parameters from AWS SSM">​</a></h3><p>You can use a special syntax to inject values from SSM in dotenv files.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">MY_LOOSELY_COUPLED_PARAM=${ssm:my-secret-name:secret-version}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This allows you to update the value for many services without redeploying which is a best practice for loosely coupled system.</p><p>Microlambda default middleware stack will interpolate the value on runtime in both local and deployed lambdas.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="secrets-and-sensitive-value">Secrets and sensitive value<a href="#secrets-and-sensitive-value" class="hash-link" aria-label="Direct link to Secrets and sensitive value" title="Direct link to Secrets and sensitive value">​</a></h2><p>Secrets should not be injected in Lambda environment variables.</p><p>Otherwise, anyone with <code>lambda:DescribeFunction</code> IAM permission could read the secret value.</p><p>Best practice is to store secret value in a vault and inject the value in-memory of the lambda at runtime.</p><p>Microlambda provides helpers to achieve this very easily, in a way that both works in local run and on deployed
functions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-manage-secrets-">How to manage secrets ?<a href="#how-to-manage-secrets-" class="hash-link" aria-label="Direct link to How to manage secrets ?" title="Direct link to How to manage secrets ?">​</a></h3><p>There are not perfect answer for this.</p><p>It depends to your project organization, processes and company culture.</p><p>There are usually two cases:</p><ul><li>You are not responsible for managing secret. Another team create them for you in AWS Secret Manager and gives you ARNs.</li><li>You are responsible for creating secrets.</li></ul><p>In the case you are responsible for creating secrets, many solutions can be considered:</p><ul><li>You may want to manage secrets with in a independent way (e.g. in other repository using Infrastructure as Code).</li><li>You want store them as your CI/CD system repository secrets, so only a subset of your team can access them and their values can be used in CI/CD. Usually CI/CD system masks them from logs and sometime you can&#x27;t consult them after creation. </li><li>You do not want to store your secrets in your CI/CD system, but just in AWS Secret Manager. This way, they are stored in a unique place reducing risks of leaks. Fine-grained permission can be set for your team using IAM.</li></ul><p>According to te way you usually manage secrets in your project/company you should find the solution that fit your needs in
the three sections below.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-secrets-already-exists-in-aws-secret-manager-vault">The secrets already exists in AWS Secret Manager Vault<a href="#the-secrets-already-exists-in-aws-secret-manager-vault" class="hash-link" aria-label="Direct link to The secrets already exists in AWS Secret Manager Vault" title="Direct link to The secrets already exists in AWS Secret Manager Vault">​</a></h3><p>In your dotenv file, you just have to use this special syntax:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">MY_SUPER_SECRET=${secrets:my-secret-name:secret-version}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The microlambda framework will take care of everything, including:</p><ul><li>Inject the secret <strong>value</strong> in the environment variable on local run</li><li>Inject the secret <strong>ARN</strong> in deployed lambdas environment variables</li><li>Grant deployed lambda IAM permission to decipher secret value</li><li>Replace secret ARN with secret value in Lambda environment on runtime (in-memory, with a built-in <code>before</code> middleware).</li></ul><blockquote><p><strong>Important:</strong> If you are using infrastructure replication capabilities, make sure your secret is available in every region you target environment is deployed on.</p></blockquote><blockquote><p>Notice: For the local run, the <code>defaultRegion</code> specified in your <code>mila.json</code> configuration will be used as target region for AWS Secret Manager.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="manage-secrets-using-microlambda-cli">Manage secrets using Microlambda CLI<a href="#manage-secrets-using-microlambda-cli" class="hash-link" aria-label="Direct link to Manage secrets using Microlambda CLI" title="Direct link to Manage secrets using Microlambda CLI">​</a></h3><p>If you do not want to store your secrets as repository variable, you can use the CLI to create secrets.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-new-secret">Create a new secret<a href="#create-a-new-secret" class="hash-link" aria-label="Direct link to Create a new secret" title="Direct link to Create a new secret">​</a></h4><p>You can use the command <code>yarn mila secrets add</code> to add a secret.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; yarn mila secrets add</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Please select the secret scope</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[X] global</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[ ] service-specific</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Please select the environment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[X] all environments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[ ] a specific environment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Select a key for the secret in process.env</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MY_SUPER_SECRET</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enter a name for your secret</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">my-awesome-app/shared/super-secret</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enter a value for your secret</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*********</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The secret is created and replicated in all regions were the target lambdas are deployed.</p><p>The special value is injected in the correct dotenv</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">MY_SUPER_SECRET=${secrets:my-awesome-app/shared/super-secret}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>You can do this process manually, by creating the secret with the AWS CLI or in AWS Console. In this case, do not forget
to replicate the secret in all AWS regions it is consumed</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-secret-value">Update secret value<a href="#update-secret-value" class="hash-link" aria-label="Direct link to Update secret value" title="Direct link to Update secret value">​</a></h4><p>You can use the command <code>yarn mila secrets update MY_SUPER_SECRET</code> to update the secret value.</p><p>You may need to specify the scope of the secret using <code>-e</code> and <code>-s</code> flags.</p><p><code>yarn mila secrets update -e dev -s awesome-service MY_API_SECRET_KEY</code>.</p><p>With this command, the value will be updated in AWS Secrets Manager in all required regions.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="delete-secret">Delete secret<a href="#delete-secret" class="hash-link" aria-label="Direct link to Delete secret" title="Direct link to Delete secret">​</a></h4><p>You can use the command <code>yarn mila secrets delete MY_SUPER_SECRET</code> to delete secret.</p><p>You may need to specify the scope of the secret using <code>-e</code> and <code>-s</code> flags.</p><p><code>yarn mila secrets delete -e dev -s awesome-service MY_API_SECRET_KEY</code>.</p><p>With this command, the value will be deleted in AWS Secrets Manager in all required regions and removed from the correct
dotenv file.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pros-and-cons">Pros and cons<a href="#pros-and-cons" class="hash-link" aria-label="Direct link to Pros and cons" title="Direct link to Pros and cons">​</a></h4><p>Pros:</p><ul><li>A secret can be created for many services/stages at the same time.</li><li>Secret single source of truth is respected</li><li>When removing an environment, a service or a regional replicate, microlambda will destroy all related secrets.</li></ul><p>Cons:</p><ul><li>This must be done manually by the project leader or someone who have access to secret values.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-grant-lambda-execution-role-the-permission-to-get-secret-value-">How to grant Lambda execution role the permission to get secret value ?<a href="#how-to-grant-lambda-execution-role-the-permission-to-get-secret-value-" class="hash-link" aria-label="Direct link to How to grant Lambda execution role the permission to get secret value ?" title="Direct link to How to grant Lambda execution role the permission to get secret value ?">​</a></h4><p>No need.</p><p>The permission to get secret value is granted to the Lambda via the microlambda serverless plugin when packaging or
starting the project.</p><p>So you don&#x27;t have to add the permissions yourself in serverless.yml IAM roles statements.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-is-the-secret-injected-on-runtime-">How is the secret injected on runtime ?<a href="#how-is-the-secret-injected-on-runtime-" class="hash-link" aria-label="Direct link to How is the secret injected on runtime ?" title="Direct link to How is the secret injected on runtime ?">​</a></h4><p>In the default project middleware stack, a before middleware will replace secret ARN by secret value on the target environment variable key.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="should-i-version-my-secrets-">Should I version my secrets ?<a href="#should-i-version-my-secrets-" class="hash-link" aria-label="Direct link to Should I version my secrets ?" title="Direct link to Should I version my secrets ?">​</a></h4><p>It depends.</p><p>If it does (or not) not make sense that the previous value is used when you redeploy from a previous state (e.g. from a previous git commit for a rollback).</p><p>For instance, if you are consuming an API and the key is rotated, you want the key to be rotated also in previous version. In this case do not version.</p><p>In another scenario where you are using API v1 with a secret key and change to API v2 with another secret key, you might want to version the secret, or simply use a different environment variable name.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorial-basics/using-middleware"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using middleware</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/deploy-your-app"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploy your app</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#using-dotenv" class="table-of-contents__link toc-highlight">Using dotenv</a><ul><li><a href="#injecting-parameters-from-aws-ssm" class="table-of-contents__link toc-highlight">Injecting parameters from AWS SSM</a></li></ul></li><li><a href="#secrets-and-sensitive-value" class="table-of-contents__link toc-highlight">Secrets and sensitive value</a><ul><li><a href="#how-to-manage-secrets-" class="table-of-contents__link toc-highlight">How to manage secrets ?</a></li><li><a href="#the-secrets-already-exists-in-aws-secret-manager-vault" class="table-of-contents__link toc-highlight">The secrets already exists in AWS Secret Manager Vault</a></li><li><a href="#manage-secrets-using-microlambda-cli" class="table-of-contents__link toc-highlight">Manage secrets using Microlambda CLI</a></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/microlambda" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/microlambda/microlambda" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Neoxia Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8c86b5e8.js"></script>
<script src="/assets/js/main.0bf2ee4f.js"></script>
</body>
</html>